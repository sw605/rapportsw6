% Metatext
This section contains documentation of the system design, consisting of the structural and behavioral design.
\todo{add metatext}

% Divided into structual & behavioral design
\subsubsection{Structual Design}
% overall system design intro
The overall structural design of the system is based on the analysis of the first iteration.

To exploit availability of sensors and computational power, the system is developed to consist of two parts: the phone application and the aSTEP system.
The two parts have their own delegated responsibilities, and will perform the necessary tasks, enabling the system to deliver the service\todo{define solution service in analysis/problem?}.

% The app
The application, hereafter referenced as the app, is the program executed on a mobile device, and will gather location data and serve as the GUI. 

% device limitations -> app abilities
The solution is assumed to require much processing power and access to all location data to analyze the possible combinations of routes.
Computing the route combinations in an app would require an amount of data transfer, to be able to compare the local user's data to all the other user's data.
Data transfer is slow and costly on a mobile device.\todo{just say phone? add source}
Additionally, there are privacy concerns regarding storage of every other user of the solution on a device, as the device could be tampered with, enabling a malicious user to gather data about other users. \todo{name battery concerns as well?}

Under the assumption that a central server can handle the analysis of the routes, the application need only to supply the server with location data to analyze.

\begin{figure}[h]
	\centering
	\input{figures/packageDiagramSprint1.tex}
	\caption{The overall structure.}
	\label{fig:packageDiagramSprint1}
\end{figure}

A background service would enable the location data sampling and transfer to a server.
As seen in Figure \ref{fig:classDiagramSprint1Observer} the Observer class' main goal is to observe what activity the user is currently doing.
If the activity is driving\todo{do we yet know 'driving' activity from GPS?}, the background service starts to store the locations with the RouteBuilder class.
When the Observer detects that the user stops driving, the Observer sends the route to the server.

\begin{figure}[h]
	\centering
	\input{figures/classDiagramSprint1Observer.tex}
	\caption{The small process which should run at all time to build the routes.}
	\label{fig:classDiagramSprint1Observer}
\end{figure}


% The aSTEP core
On the server, the route is stored in a database and accessed by the RouteStabilityAnalyser.
This analyzer takes the route and compares it to other routes by the same user, to determine whether this route is a regular occurrence, and hence a stable route.

If the RouteStabilityAnalyser determines that the route is stable, the information is stored in the database with when this route occurs\todo{with temporal metadata?}.
The server then uses the RouteSimilarityAnalyser to find matches for the new\todo{does not need to be a new stable route??} StableRoute.
The matches are stored and new matches are transmitted to the appropriate devices to inform the users of a new match.

\begin{figure}[h]
	\centering
	\input{figures/classDiagramSprint1Server.tex}
	\caption{The structure of the system inside the server. This package should be an isolated system within the server.}
	\label{fig:classDiagramSprint1Server}
\end{figure}

The application acts as an interface to the background process for the user.
This is where the user logs in and can see an overview of candidates for car pooling.

\begin{figure}[h]
	\centering
	\input{figures/classDiagramSprint1Application.tex}
	\caption{The class structure of the application.}
	\label{fig:classDiagramSprint1Application}
\end{figure}

This is the start of a project that will be further developed and expanded in the future, emphasizing the importance of \todo{code/module} reuse, to reduce unused server resources\todo{what does this last part mean?}.
By isolating parts that are specific to the rideshare app, most of the system\todo{what system? Device or aSTEP?} would be reusable.
The best example of this is the RouteAnalyser from Figure \ref{fig:classDiagramSprint1Server}.
The RouteAnalyzer filter routes according to its concrete implementation.
After the filtering, the RouteAnalyser uses the strategy pattern to determine how to compare the routes.
This enables other projects to develop their own filters and comparison functions in later projects.

To reduce the search space, a weekly stability was decided. \todo{did we?}
This means that the RouteStabilityAnalyser can be limited to analyze one to two months of data.
This will be further tested and evaluated in another chapter. \todo{reference to test and evaluation}